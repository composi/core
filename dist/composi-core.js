!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.composi={})}(this,(function(e){"use strict";const n=0,t=3,o={},r=[],l=[];function s(e,n,t,o,r=null,l=null){return{type:e,props:n,children:t,node:o,flag:l,key:r}}function i(e,n){return s(e,o,r,n,null,t)}function u(e,n){return JSON.stringify(e)!==JSON.stringify(n)}function c(e,n){return Object.assign({},e,n)}function a(e){this.handlers[e.type](e)}function d(e,n,t,o,r){if("key"===n);else if("style"===n&&"object"==typeof o)for(let r in c(t,o)){const t=null==o||null==o[r]?"":o[r];"-"===r[0]?e[n].setProperty(r,t):e[n][r]=t}else"o"===n[0]&&"n"===n[1]?((e.handlers||(e.handlers={}))[n=n.slice(2)]=o)?t||e.addEventListener(n,a):e.removeEventListener(n,a):"list"!==n&&"form"!==n&&"type"!==n&&"draggable"!==n&&"spellcheck"!==n&&n in e&&!r?e[n]=null==o?"":o:null==o||!1===o?e.removeAttribute(n):e.setAttribute(n,o)}function f(e,n,o){const r=String(e.type),l=e.flag===t?document.createTextNode(r):(o=o||"svg"===r)?document.createElementNS("http://www.w3.org/2000/svg",r):document.createElement(r),s=e.props;s.onmount&&n.push((function(){s.onmount(l)}));for(let e in s)d(l,e,null,s[e],o);for(let t=0,r=e.children.length;t<r;t++)l.appendChild(f(e.children[t],n,o));return e.node=l}function p(e){return null==e?null:e.key}function h(e,n){const t=function(){e.removeChild(function e(n){for(let t=0,o=n.children.length;t<o;t++)e(n.children[t]);const t=n.props.ondestroy;return null!=t&&t(n.node),n.node}(n))},o=n.props&&n.props.onunmount;null!=o?o(n.node,t):t()}function y(e){return e.nodeType===t?i(e.nodeValue,e):s(e.nodeName.toLowerCase(),o,Array.prototype.map.call(e.childNodes,y),e,null,n)}function m(e,o){e.vdom||o.props.onmount&&l.push((function(){o.props.onmount(e)}));const r=(function e(o,r,s,i,a){if(s===i);else if(null!=s&&s.flag===t&&i.flag===t)s.type!==i.type&&(r.nodeValue=i.type);else if(null==s||s.type!==i.type)r=o.insertBefore(f(i,l,a),r),null!=s&&h(o,s);else{let t,o,y,m;const g=s.props,v=i.props,w=s.children,b=i.children;let k=0,T=0,A=w.length-1,O=b.length-1;a=a||"svg"===i.type;for(let e in c(g,v))if(("value"===e||"selected"===e||"checked"===e?r[e]:g[e])!==v[e]){d(r,e,g[e],v[e],a);const n=v.onupdate;null!=n&&u(g,v)&&l.push((function(){n(r,g,v)}))}for(;T<=O&&k<=A&&null!=(y=p(w[k]))&&y===p(b[T]);)e(r,w[k].node,w[k++],b[T++],a);for(;T<=O&&k<=A&&null!=(y=p(w[A]))&&y===p(b[O]);)e(r,w[A].node,w[A--],b[O--],a);if(k>A)for(;T<=O;)r.insertBefore(f(b[T++],l,a),(o=w[k])&&o.node);else if(T>O)for(;k<=A;)h(r,w[k++]);else{let l,i,u;for(l=k,i={},u={};l<=A;l++)null!=(y=w[l].key)&&(i[y]=w[l]);for(;T<=O;)y=p(o=w[k]),m=p(b[T]),u[y]||null!=m&&m===p(w[k+1])?(null==y&&h(r,o),k++):null==m||s.flag===n?(null==y&&(e(r,o&&o.node,o,b[T],a),T++),k++):(y===m?(e(r,o.node,o,b[T],a),u[m]=!0,k++):null!=(t=i[m])?(e(r,r.insertBefore(t.node,o&&o.node),t,b[T],a),u[m]=!0):e(r,o&&o.node,null,b[T],a),T++);for(;k<=A;)null==p(o=w[k++])&&h(r,o);for(let e in i)null==u[e]&&h(r,i[e])}}return i.node=r}(e.parentNode,e,e.vdom||y(e),o)).vdom=o;for(;l.length>0;)l.pop()();return r}const g=Object.prototype.hasOwnProperty;function v(e,n,t){return e.type?(e=>{const{type:o,data:r}=e,l=g.call(n,o)&&n[o];return l?l(r):t?t():console.error(`The message you sent has no matching action method. Check the spelling for the message or the action method. The message type was "${o}".`)})(e):(console.error("The message you provided was not valid. Messages have the format: {type: 'whatever', data?: 'something'}"),console.error("The tag you provided was:"),void console.dir(e))}function w(e){const n=Object.create(null);let t=0;for(;t<e.length;){const o=e[t];"match"===o&&console.error('The message type you provided was "match". This cannot be used since it would override the message union\'s own match method. Please change it to something else, such as "matchName", etc.'),n[o]=e=>({type:o,data:e}),t++}return{variants:n,match:v}}const b=(...e)=>(n,t)=>e.map(e=>e&&e(n,t)),k=b;e.h=function(e,n,...t){let o;n=n||{};const r=[],l=[];let u=t.length;const c=n.key;for(;u-- >0;)r.push(t[u]);for(n.children&&(r.length<=0&&r.push(n.children),delete n.children);r.length>0;)if(Array.isArray(o=r.pop())){let e=o.length;for(;e-- >0;)r.push(o[e])}else!1===o||!0===o||null==o||l.push("object"==typeof o?o:i(o));return"function"==typeof e?e(n,l):s(e,n,l,null,c)},e.render=function(e,n){if(Array.isArray(e))throw"Cannot insert Fragment tag directly into DOM.";let t="";if("string"==typeof n&&(t=n,n=document.querySelector(n)),!n){let e="";t&&(e=` The selector you provided was: "${t}"`),console.error(`@composi/core Error: The second parameter for render function was invalid. Check the selector you provided and make sure that it exists in the DOM before trying to render. ${e}`)}m(n,e)},e.run=function(e){let n=e.init;const t=e.view,o=e.update,r=e.subscriptions||e.subs,l=e.done;let s,i=!0,u=!0;const c=()=>s;function a(e,n){let t=e;if(i)return"function"==typeof e&&(t=e(n)),d(o(s,t,a))}function d(e){e?s=e:n&&(s=n()),r&&u&&("function"==typeof r&&r(a,c),u=!1),t(s,a)}return e.send=a,d(s),()=>{i&&(i=!1,l&&l(s))}},e.union=function(...e){const{variants:n,match:t}=w(e);return n.match=t,n},e.batchEffects=b,e.batch=k,e.Fragment=(e,n)=>Array.isArray(e)&&!n?e:n,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=composi-core.js.map
